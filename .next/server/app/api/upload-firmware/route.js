(()=>{var e={};e.id=185,e.ids=[185],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9646:e=>{"use strict";e.exports=require("child_process")},4735:e=>{"use strict";e.exports=require("events")},9021:e=>{"use strict";e.exports=require("fs")},1820:e=>{"use strict";e.exports=require("os")},3873:e=>{"use strict";e.exports=require("path")},8354:e=>{"use strict";e.exports=require("util")},4052:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>m,serverHooks:()=>v,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{POST:()=>f});var n=t(2706),i=t(8203),o=t(5994),a=t(9187);let p=require("fs/promises");var u=t(3873),c=t.n(u),l=t(3168),d=t(9646);async function f(e){try{let r=(await e.formData()).get("firmware");if(!r)return a.NextResponse.json({error:"No file uploaded"},{status:400});let t=await r.arrayBuffer(),s=c().join("/tmp",r.name);if(await (0,p.writeFile)(s,Buffer.from(t)),!l.devices().find(e=>e.product?.includes("Teensy")))return a.NextResponse.json({error:"No Teensy LC detected"},{status:404});return(0,d.exec)(`teensy_loader_cli --mcu=TEENSYLC -w -v ${s}`,(e,r,t)=>{e&&console.error("Error flashing firmware:",t)}),a.NextResponse.json({success:!0,message:"Firmware uploaded!"})}catch(r){let e=r instanceof Error?r.message:"An unknown error occurred";return a.NextResponse.json({error:e},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/upload-firmware/route",pathname:"/api/upload-firmware",filename:"route",bundlePath:"app/api/upload-firmware/route"},resolvedPagePath:"/Users/sergey/Documents/Programming/029_pvsensors_web/pvsensors_web/src/app/api/upload-firmware/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:v}=m;function _(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}},6487:()=>{},8335:()=>{},2706:(e,r,t)=>{"use strict";e.exports=t(4870)},7367:e=>{e.exports={name:"HID",napi_versions:[3]}},3168:(e,r,t)=>{let s=t(4735).EventEmitter,n=t(8354),i=null,o=null;function a(){if(!o){let e=t(7367);"linux"!==process.platform||i&&"hidraw"!==i||(e.name="HID_hidraw"),o=t(8e3)(__dirname,e)}}function p(){if(!new.target)throw Error("HID() must be called with 'new' operator");s.call(this),a();var e=Array(arguments.length+1);e[0]=null;for(var r=0;r<arguments.length;r++)e[r+1]=arguments[r];for(var r in this._raw=new(Function.prototype.bind.apply(o.HID,e)),o.HID.prototype)this[r]=o.HID.prototype[r].bind(this._raw);this._paused=!0;var t=this;t.on("newListener",function(e,r){"data"==e&&process.nextTick(t.resume.bind(t))})}n.inherits(p,s),p.prototype.close=function(){this._closing=!0,this.removeAllListeners(),this._raw.close(),this._closed=!0},p.prototype.pause=function(){this._paused=!0},p.prototype.read=function(e){if(!this._closed)return this._raw.read(e);throw Error("Unable to read from a closed HID device")},p.prototype.resume=function(){var e=this;e._paused&&e.listeners("data").length>0&&(e._paused=!1,e.read(function r(t,s){try{t?(e._paused=!0,e._closing||e.emit("error",t)):(e.listeners("data").length<=0&&(e._paused=!0),e._paused||e.read(r),e.emit("data",s))}catch(r){setImmediate(()=>{e.emit("error",r)})}}))};class u extends s{constructor(e){if(super(),!(e instanceof o.HIDAsync))throw Error("HIDAsync cannot be constructed directly. Use HIDAsync.open() instead");for(let r in this._raw=e,this._raw)this[r]=async(...e)=>this._raw[r](...e);this.on("newListener",(e,r)=>{"data"==e&&process.nextTick(this.resume.bind(this))}),this.on("removeListener",(e,r)=>{"data"==e&&0==this.listenerCount("data")&&process.nextTick(this.pause.bind(this))})}static async open(...e){return a(),new u(await o.openAsyncHIDDevice(...e))}async close(){this._closing=!0,this.removeAllListeners(),await this._raw.close(),this._closed=!0}pause(){this._raw.readStop()}resume(){this.listenerCount("data")>0&&this._raw.readStart((e,r)=>{try{e?this._closing||this.emit("error",e):this.emit("data",r)}catch(e){setImmediate(()=>{this.emit("error",e)})}})}}r.HID=p,r.HIDAsync=u,r.devices=function(){return a(),o.devices.apply(p,arguments)},r.devicesAsync=function(...e){return a(),o.devicesAsync(...e)},r.setDriverType=function(e){i=e}},8e3:(e,r,t)=>{let s=t(3873),n=t(1820),{getPrebuildName:i,isNwjs:o,isElectron:a,isAlpine:p}=t(8877),u="undefined"!=typeof jest?jest.requireActual("fs"):t(9021),c=require;function l(e,r,t,c){let l;if("string"!=typeof e||!e)throw Error("Invalid basePath to pkg-prebuilds");if("object"!=typeof r||!r)throw Error("Invalid options to pkg-prebuilds");if("string"!=typeof r.name||!r.name)throw Error("Invalid name to pkg-prebuilds");let d=!1;r.napi_versions&&Array.isArray(r.napi_versions)&&(d=!0);let f=t&&process.env.npm_config_arch||n.arch(),m=t&&process.env.npm_config_platform||n.platform(),h="node";!d&&(t&&process.env.npm_config_runtime?h=process.env.npm_config_runtime:a()?h="electron":o()&&(h="node-webkit"));let w=[];if(t||w.push(s.join(e,"build","Debug",`${r.name}.node`),s.join(e,"build","Release",`${r.name}.node`)),p(m)&&(l="musl"),d)for(let t of r.napi_versions){let n=i({name:r.name,platform:m,arch:f,libc:l,napi_version:t,runtime:h});w.push(s.join(e,"prebuilds",n))}else throw Error("Not implemented for NAN!");let v=null;for(let e of w)if(u.existsSync(e)&&u.statSync(e).isFile()){v=e;break}if(!v&&c){let e=w.map(e=>` - ${e}`).join("\n");throw Error(`Failed to find binding for ${r.name}
Tried paths:
${e}`)}return v}function d(e,r){let t=l(e,r,!1,!0);if(!t)throw Error(`Failed to find binding for ${r.name}`);return c(t)}d.resolve=l,e.exports=d},8877:(e,r,t)=>{let s=t(9021);e.exports={getPrebuildName:function(e){if(!e.napi_version)throw Error("NAN not implemented");let r=[e.name,e.platform,e.arch,e.libc&&"linux"===e.platform?e.libc:null];return`${r.filter(e=>!!e).join("-")}/${e.runtime}-napi-v${e.napi_version}.node`},isNwjs:function(){return!!(process.versions&&process.versions.nw)},isElectron:function(){return!!process.versions&&!!process.versions.electron||!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type},isAlpine:function(e){return"linux"===e&&s.existsSync("/etc/alpine-release")}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[680],()=>t(4052));module.exports=s})();